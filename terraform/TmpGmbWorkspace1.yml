# GMB Add this in later.
# Deploy an Azure Monitor Workspace
resource "azurerm_monitor_account" "iot_monitor_workspace" {
  name                = "${var.prefix}-monitor-workspace"
  resource_group_name = var.resource_group_name
  location            = var.location
  // You might want to add tags here as well
  tags = {
    environment = var.environment
    project     = var.project
    owner       = var.owner
  }
}


# Deploy an Azure Managed Grafana instance with system-assigned identity and tags for ownership
resource "azurerm_dashboard_grafana" "iot_grafana" {
  name                        = "${var.prefix}-grafana"
  location                    = var.location
  resource_group_name         = var.resource_group_name
  grafana_major_version       = 11
  api_key_enabled             = true
  public_network_access_enabled = true

  identity {
    type = "SystemAssigned"
  }

  tags = {
    environment = var.environment
    project     = var.project
    owner       = var.owner
  }

  # GMB Add this in later.
  azure_monitor_workspace_integrations {
    # CORRECTED: Referencing the ID of the azurerm_monitor_account resource
    resource_id = azurerm_monitor_account.iot_monitor_workspace.id
  }
}