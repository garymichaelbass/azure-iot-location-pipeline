resource "databricks_job" "iot_job" {
  name = "iot-simulator-job"
  
  notebook_task {
    notebook_path = var.notebook_path
    base_parameters = {
      eventhub_connection_string = var.eventhub_connection_string
    }
  }

  existing_cluster_id = databricks_cluster.iot_cluster.id
}

# Create a Databricks job that executes the uploaded notebook on the specified cluster
resource "databricks_job" "iot_job" {
  name = "iot-simulator-job"

  task {
    task_key = "simulate-iot"
    existing_cluster_id = databricks_cluster.iot_cluster.id

    notebook_task {
      notebook_path = databricks_notebook.iot_notebook.path
      base_parameters = {
        device_count               = "100"
        # --- ADD THIS LINE ---
        eventhub_connection_string = var.eventhub_connection_string
        # --- END ADDITION ---
      }
    }
  }
}