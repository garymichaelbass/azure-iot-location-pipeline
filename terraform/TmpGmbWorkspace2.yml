- name: Conditionally import resource group if it exists
  run: |
    RG_NAME="iot-location-rg"
    SUB_ID="${{ secrets.AZURE_SUBSCRIPTION_ID }}"

    echo "üîç Checking if Resource Group '$RG_NAME' exists in Azure..."
    if az group show --name "$RG_NAME" --output none 2>/dev/null; then
      echo "‚úÖ Resource group '$RG_NAME' exists."
      if ! terraform state show azurerm_resource_group.iot_resource_group &>/dev/null; then
        echo "üõ†Ô∏è Importing '$RG_NAME' into Terraform state..."
        terraform import azurerm_resource_group.iot_resource_group "/subscriptions/$SUB_ID/resourceGroups/$RG_NAME"
      else
        echo "ü™™ Resource group already in Terraform state. No import needed."
      fi
    else
      echo "‚ùå Resource group '$RG_NAME' does not exist in Azure. Skipping import."
    fi
  working-directory: ./terraform
  shell: bash
  env:
    TF_VAR_github_client_id: ${{ secrets.AZURE_CLIENT_ID }}
    TF_VAR_github_client_secret: ${{ secrets.AZURE_CLIENT_SECRET }}
    TF_VAR_github_tenant_id: ${{ secrets.AZURE_TENANT_ID }}
    TF_VAR_github_subscription_id: ${{ secrets.AZURE_SUBSCRIPTION_ID }}