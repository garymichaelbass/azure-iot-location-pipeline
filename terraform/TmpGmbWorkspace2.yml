# azure-iot-location-monitoring\terraform\modules.tf

module "databricks_iot" {
  source = "./modules/databricks"

  cosmos_db_endpoint         = azurerm_cosmosdb_account.iot_cosmosdb_account.endpoint
  cosmos_db_key              = azurerm_cosmosdb_account.iot_cosmosdb_account.primary_key
  eventhub_connection_string = azurerm_eventhub_namespace_authorization_rule.iot_send_rule.primary_connection_string
  databricks_workspace_url_input = azurerm_databricks_workspace.iot_databricks_workspace.workspace_url

  # --- ADD THESE NEW LINES ---
  cosmos_db_database_name  = azurerm_cosmosdb_sql_database.iot_cosmosdb_database.name
  cosmos_db_container_name = azurerm_cosmosdb_sql_container.iot_cosmosdb_sql_container.name
  # --- END ADDITION ---

  providers = {
    databricks = databricks.workspace
  }

  depends_on = [
    azurerm_databricks_workspace.iot_databricks_workspace,
    azurerm_cosmosdb_account.iot_cosmosdb_account,
    azurerm_cosmosdb_sql_database.iot_cosmosdb_database, # Add dependency on database
    azurerm_cosmosdb_sql_container.iot_cosmosdb_sql_container # Add dependency on container
  ]
}